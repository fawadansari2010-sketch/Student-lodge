<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fawad Apps â€“ Student Lodge</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon.png">
<meta name="theme-color" content="#4f46e5">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --bg:#f4f4f5;
  --card:#ffffff;
  --text:#111827;
  --primary:#4f46e5;
  --border:#d1d5db;
  --shadow:0 4px 12px rgba(0,0,0,.1);
}
body.dark{
  --bg:#020617;
  --card:#1e293b;
  --text:#e5e7eb;
  --border:#334155;
  --shadow:0 4px 12px rgba(0,0,0,.35);
}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* Header */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 16px;
  background:var(--card);
  box-shadow:var(--shadow);
  position:sticky;
  top:0;
  z-index:100;
  border-radius:0 0 22px 22px;
}
.menu{font-size:24px;cursor:pointer;}
.title{font-weight:700;font-size:18px}

/* Menu */
#menu{
  position:fixed;
  top:70px;
  left:10px;
  width:210px;
  background:var(--card);
  border-radius:22px;
  padding:12px;
  box-shadow:var(--shadow);
  display:none;
  z-index:200;
}
#menu button{width:100%;margin:6px 0}

/* Search */
#searchCard{
  margin:10px;
  padding:6px;
  background:var(--card);
  border-radius:22px;
  box-shadow:var(--shadow);
}

/* Table */
.table-wrap{
  margin:10px;
  background:var(--card);
  border-radius:22px;
  box-shadow:var(--shadow);
  max-height:65vh;
  overflow:auto;
  padding:8px;
}
table{width:100%;border-collapse:separate;border-spacing:0 8px;}
td{
  padding:6px;
  border-radius:14px;
}
.paid{background:#16a34a;color:#fff}
.not-paid{background:#dc2626;color:#fff}

input,select{
  width:100%;
  min-height:42px;
  padding:10px;
  border:1.5px solid var(--border);
  border-radius:14px;
  font-size:14px;
}
button{
  border:none;
  border-radius:16px;
  padding:10px;
  background:var(--primary);
  color:white;
  font-size:14px;
  cursor:pointer;
  box-shadow:var(--shadow);
}

/* FAB */
#fab{
  position:fixed;
  right:20px;
  bottom:20px;
  width:60px;
  height:60px;
  border-radius:50%;
  background:var(--primary);
  color:white;
  font-size:32px;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:var(--shadow);
}
</style>
</head>

<body>

<header>
  <div class="menu" onclick="toggleMenu()">â˜°</div>
  <div class="title">Fawad Apps</div>
</header>

<div id="menu">
  <button onclick="toggleDark()">ðŸŒ™ Dark Mode</button>
  <button onclick="exportPDF()">ðŸ“„ Export PDF</button>
  <button onclick="backup()">ðŸ“¤ Backup</button>
  <button onclick="restore()">ðŸ“¥ Restore</button>
  <button onclick="changePin()">ðŸ”‘ Change PIN</button>
</div>

<div id="searchCard">
  <input placeholder="Search name / room" oninput="search(this.value)">
</div>

<div class="table-wrap">
  <table><tbody id="tbody"></tbody></table>
</div>

<div id="fab" onclick="addStudent()">ï¼‹</div>

<script>
/* PIN LOCK */
if(!localStorage.getItem("pin")) localStorage.setItem("pin","1234");
(function(){
  const pin=localStorage.getItem("pin");
  const p=prompt("Enter PIN");
  if(p!==pin){alert("Wrong PIN");location.reload();}
})();

/* DATA */
let data = JSON.parse(localStorage.getItem("data")||"[]");
const tbody=document.getElementById("tbody");
const menu=document.getElementById("menu");

/* MENU */
function toggleMenu(){
  menu.style.display = menu.style.display==="block"?"none":"block";
}
document.addEventListener("click",e=>{
  if(!menu.contains(e.target)&&!e.target.classList.contains("menu")){
    menu.style.display="none";
  }
});

/* DARK MODE */
function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("dark",document.body.classList.contains("dark"));
}
if(localStorage.getItem("dark")==="true") document.body.classList.add("dark");

/* ADD STUDENT */
function addStudent(){
  data.push({});
  save(); render();
}

/* RENDER + SWIPE DELETE */
function render(){
  tbody.innerHTML="";
  let startX=0;

  data.forEach((r,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${i+1}</td>
      <td><input placeholder="Name" value="${r.name||''}" oninput="set(${i},'name',this.value)"></td>
      <td><input placeholder="Floor" value="${r.floor||''}" oninput="set(${i},'floor',this.value)"></td>
      <td><input placeholder="Room" value="${r.room||''}" oninput="set(${i},'room',this.value)"></td>
      <td>
        <select onchange="pay(${i},this.value)" class="${r.paid?'paid':'not-paid'}">
          <option>Not Paid</option>
          <option ${r.paid?'selected':''}>Paid</option>
        </select>
      </td>`;

    tr.addEventListener("touchstart",e=>startX=e.touches[0].clientX);
    tr.addEventListener("touchend",e=>{
      if(startX-e.changedTouches[0].clientX>80){
        if(confirm("Delete this row?")){
          data.splice(i,1); save(); render();
        }
      }
    });

    tbody.appendChild(tr);
  });
}

/* HELPERS */
function set(i,k,v){data[i][k]=v;save();}
function pay(i,v){data[i].paid=v==="Paid";save();render();}
function save(){localStorage.setItem("data",JSON.stringify(data));}

/* SEARCH */
function search(q){
  [...tbody.rows].forEach(r=>{
    r.style.display=r.innerText.toLowerCase().includes(q.toLowerCase())?"":"none";
  });
}

/* PDF */
function exportPDF(){
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF();
  let y=10;
  data.forEach((r,i)=>{
    doc.text(`${i+1}. ${r.name||''} | ${r.floor||''}-${r.room||''} | ${r.paid?'Paid':'Not Paid'}`,10,y);
    y+=8;
  });
  doc.save("Student_Lodge.pdf");
}

/* BACKUP / RESTORE */
function backup(){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([JSON.stringify(data)],{type:"application/json"}));
  a.download="backup.json";a.click();
}
function restore(){
  const i=document.createElement("input");
  i.type="file";
  i.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{data=JSON.parse(r.result);save();render();}
    r.readAsText(e.target.files[0]);
  };
  i.click();
}

/* CHANGE PIN */
function changePin(){
  const old=prompt("Old PIN");
  if(old!==localStorage.getItem("pin")) return alert("Wrong PIN");
  const np=prompt("New 4-digit PIN");
  if(!np||np.length!==4) return alert("Invalid PIN");
  localStorage.setItem("pin",np);
  alert("PIN updated");
}

render();
</script>
</body>
</html>
