<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fawad Apps â€“ Student Lodge</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon.png">
<meta name="theme-color" content="#4f46e5">

<!-- jsPDF for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --bg:#f4f4f5;
  --card:#ffffff;
  --text:#111827;
  --primary:#4f46e5;
  --border:#d1d5db;
  --shadow:0 4px 12px rgba(0,0,0,0.1);
}
body.dark{
  --bg:#020617;
  --card:#1e293b;
  --text:#e5e7eb;
  --border:#334155;
  --shadow:0 4px 12px rgba(0,0,0,0.3);
}
body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* Header */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 16px;
  background:var(--card);
  box-shadow:var(--shadow);
  position: sticky;
  top:0;
  z-index:100;
  border-bottom-left-radius:20px;
  border-bottom-right-radius:20px;
}
.menu{font-size:24px;cursor:pointer;}
.title{font-weight:700;font-size:18px}

/* Menu card */
#menu{
  position:fixed;
  top:60px;
  right:10px;
  width:200px;
  background:var(--card);
  border-radius:22px;
  padding:12px;
  box-shadow:var(--shadow);
  z-index:99;
  display:none;
  transition:0.3s;
}

/* Search bar sticky */
#searchCard{
  position:sticky;
  top:72px;
  z-index:90;
  margin:10px;
  border-radius:22px;
  background:var(--card);
  box-shadow:var(--shadow);
  padding:6px;
}

/* Table card */
.table-wrap{
  overflow:auto;
  max-height:65vh;
  margin:10px;
  border-radius:22px;
  background:var(--card);
  box-shadow:var(--shadow);
  padding:8px;
}
table{
  width:100%;
  border-collapse: separate;
  border-spacing:0 8px;
}
td{
  background:var(--card);
  padding:6px;
  vertical-align:middle;
  border-radius:14px;
}
.paid{background:#16a34a;color:white}
.not-paid{background:#dc2626;color:white}

/* Inputs/buttons */
input, select{
  width:100%;
  min-height:40px;
  padding:10px;
  border:1.5px solid var(--border);
  border-radius:14px;
  font-size:14px;
  box-sizing:border-box;
}
input:focus, select:focus{outline:none;border-color:var(--primary);}
button{
  border:none;
  border-radius:16px;
  padding:10px 14px;
  background:var(--primary);
  color:white;
  font-size:14px;
  margin-top:6px;
  box-shadow:var(--shadow);
  cursor:pointer;
}

/* Floating Action Button */
#fab{
  position:fixed;
  bottom:20px;
  right:20px;
  width:60px;
  height:60px;
  background:var(--primary);
  color:white;
  border-radius:50%;
  font-size:32px;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:var(--shadow);
  cursor:pointer;
  z-index:100;
}
</style>
</head>
<body>

<header>
  <div class="menu" onclick="toggleMenu()">â˜°</div>
  <div class="title">Fawad Apps</div>
</header>

<!-- Three-dot Menu -->
<div id="menu">
  <input type="month" id="month">
  <button onclick="toggleDark()">ðŸŒ™ Dark Mode</button>
  <button onclick="save()">ðŸ’¾ Save</button>
  <button onclick="backup()">ðŸ“¤ Backup</button>
  <button onclick="restore()">ðŸ“¥ Restore</button>
  <button onclick="exportPDF()">ðŸ“„ PDF</button>
  <button onclick="changePassword()">ðŸ”‘ Change Password</button>
</div>

<div id="searchCard">
  <input placeholder="Search name / room" oninput="search(this.value)">
</div>

<div class="table-wrap">
  <table>
    <tbody id="tbody"></tbody>
  </table>
</div>

<div id="fab" onclick="addStudent()">ï¼‹</div>

<script>
let data = [];
const tbodyEl = document.getElementById("tbody");
const menuEl = document.getElementById("menu");

// Toggle menu open/close
function toggleMenu(){
  menuEl.style.display = menuEl.style.display === "block" ? "none" : "block";
}

// Dark mode
function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("dark",document.body.classList.contains("dark"));
}
if(localStorage.getItem("dark")==="true") document.body.classList.add("dark");

// Add student
function addStudent(){
  data.push({});
  render();
}

// Render table
function render(){
  tbodyEl.innerHTML="";
  const frag=document.createDocumentFragment();
  let totalPaid = 0;

  data.forEach((r,i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i+1}</td>
      <td><input placeholder="Name" value="${r.name||''}" oninput="set(${i},'name',this.value)"></td>
      <td><input placeholder="Floor" value="${r.floor||''}" oninput="set(${i},'floor',this.value)"></td>
      <td><input placeholder="Room" value="${r.room||''}" oninput="set(${i},'room',this.value)"></td>
      <td>
        <select onchange="pay(${i},this.value)" class="${r.paid?'paid':'not-paid'}">
          <option>Not Paid</option>
          <option ${r.paid?'selected':''}>Paid</option>
        </select>
      </td>`;
    frag.appendChild(tr);
    if(r.paid) totalPaid++;
  });

  tbodyEl.appendChild(frag);
  document.title = `Paid: ${totalPaid}/${data.length}`;
}

// Set field
function set(i,k,v){ data[i][k]=v; }

// Payment toggle
function pay(i,v){ data[i].paid=v==="Paid"; render(); }

// Save / Backup / Restore
function save(){ localStorage.setItem("data",JSON.stringify(data)); alert("Saved"); }
function backup(){ const a=document.createElement("a"); a.href=URL.createObjectURL(new Blob([JSON.stringify(data)],{type:"application/json"})); a.download="backup.json"; a.click(); }
function restore(){ const i=document.createElement("input"); i.type="file"; i.onchange=e=>{ const r=new FileReader(); r.onload=()=>{data=JSON.parse(r.result); render();}; r.readAsText(e.target.files[0]); }; i.click(); }

// Search
function search(q){ [...tbodyEl.rows].forEach(r=>r.style.display=r.innerText.toLowerCase().includes(q.toLowerCase())?"":"none"); }

// Export PDF
function exportPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const monthInput = document.getElementById("month").value;
  const filename = monthInput ? monthInput.replace('-','_')+'.pdf' : 'Student_Lodge.pdf';
  let content="<table border='1'><tr><th>No</th><th>Name</th><th>Floor</th><th>Room</th><th>Status</th></tr>";
  data.forEach((r,i)=>content+=`<tr><td>${i+1}</td><td>${r.name||''}</td><td>${r.floor||''}</td><td>${r.room||''}</td><td>${r.paid?'Paid':'Not Paid'}</td></tr>`);
  content+="</table>";
  doc.html(content,{callback:function(doc){doc.save(filename)},x:5,y:5});
}

// Change Password
function changePassword(){
  let pass = prompt("Enter new password:");
  if(pass) localStorage.setItem("appPassword",pass);
  alert("Password updated!");
}

// Load saved
data = JSON.parse(localStorage.getItem("data")||"[]");
render();
</script>
</body>
</html>
