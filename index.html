<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Lodge â€“ Fawad Apps</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:#f4f4f5;
}
body.dark{background:#020617;color:#e5e7eb}

header{
  position:sticky;
  top:0;
  background:#fff;
  padding:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  z-index:100;
}
body.dark header{background:#020617}

.menu-btn,.add-btn{
  font-size:22px;
  padding:8px 14px;
  border-radius:14px;
  cursor:pointer;
}

#menu{
  position:fixed;
  background:#fff;
  border-radius:18px;
  padding:12px;
  width:240px;
  display:none;
  z-index:1000;
  box-shadow:0 10px 30px rgba(0,0,0,.2);
}
body.dark #menu{background:#1e293b}

button{
  width:100%;
  padding:10px;
  margin:6px 0;
  border:none;
  border-radius:14px;
  background:#4f46e5;
  color:#fff;
  font-size:14px;
}

#search{
  width:calc(100% - 20px);
  margin:10px;
  padding:12px;
  border-radius:18px;
  border:1px solid #ccc;
}

.card{
  background:#fff;
  margin:10px;
  border-radius:20px;
  padding:10px;
}
body.dark .card{background:#1e293b}

.row{
  display:flex;
  align-items:center;
  gap:8px;
}

.arrow{
  cursor:pointer;
  transition:.3s;
}
.arrow.open{transform:rotate(90deg)}

.tick.paid{color:#16a34a}
.tick.unpaid{color:#dc2626}

.expand{
  display:none;
  margin-top:8px;
}
.expand.show{display:block;animation:fade .25s}

input{
  width:100%;
  padding:10px;
  margin:4px 0;
  border-radius:14px;
  border:1px solid #ccc;
}

@keyframes fade{
  from{opacity:0;transform:scale(.96)}
  to{opacity:1;transform:scale(1)}
}
</style>
</head>

<body>

<header>
  <div class="menu-btn" id="menuBtn">â‹®</div>
  <b>Fawad Apps</b>
  <div class="add-btn" onclick="addStudent()">ï¼‹</div>
</header>

<div id="menu">
  <input type="month" id="monthPicker">
  <button onclick="changeMonth()">ðŸ“… Change Month</button>
  <button onclick="save()">ðŸ’¾ Save</button>
  <button onclick="exportBackup()">ðŸ“¤ Export Backup</button>
  <button onclick="importBackup()">ðŸ“¥ Import Backup</button>
  <button onclick="toggleDark()">ðŸŒ™ Dark Mode</button>
  <button onclick="exportPDF()">ðŸ“„ Export PDF</button>
  <input type="file" id="importFile" hidden>
</div>

<input id="search" placeholder="Search name" oninput="search(this.value)">
<div id="list"></div>

<script>
/* MENU POSITION FIX */
const menu=document.getElementById("menu");
document.getElementById("menuBtn").onclick=(e)=>{
  const r=e.target.getBoundingClientRect();
  menu.style.top=(r.bottom+8)+"px";
  menu.style.left=(r.right-menu.offsetWidth)+"px";
  menu.style.display=menu.style.display==="block"?"none":"block";
};

/* DATA */
let currentMonth=localStorage.getItem("currentMonth")||new Date().toISOString().slice(0,7);
let data=JSON.parse(localStorage.getItem("data_"+currentMonth)||"[]");
monthPicker.value=currentMonth;

function addStudent(){
  data.push({name:"",room:"",floor:"",mobile:"",paid:false,open:false});
  render();
}

function toggleRow(i){data[i].open=!data[i].open;render()}
function togglePaid(i){data[i].paid=!data[i].paid;render()}
function removeRow(i){data.splice(i,1);render()}

function render(){
  list.innerHTML="";
  data.forEach((r,i)=>{
    list.innerHTML+=`
    <div class="card">
      <div class="row">
        <div>${i+1}</div>
        <div class="tick ${r.paid?"paid":"unpaid"}">${r.paid?"âœ”":"âœ–"}</div>
        <input value="${r.name}" placeholder="Name" oninput="data[${i}].name=this.value">
        <div class="arrow ${r.open?"open":""}" onclick="toggleRow(${i})">â–¶</div>
      </div>
      <div class="expand ${r.open?"show":""}">
        <input placeholder="Room" value="${r.room||""}" oninput="data[${i}].room=this.value">
        <input placeholder="Floor" value="${r.floor||""}" oninput="data[${i}].floor=this.value">
        <input placeholder="Mobile" value="${r.mobile||""}" oninput="data[${i}].mobile=this.value">
        <button onclick="togglePaid(${i})">${r.paid?"Paid":"Not Paid"}</button>
        <button style="background:#991b1b" onclick="removeRow(${i})">Delete</button>
      </div>
    </div>`;
  });
}

function search(q){
  q=q.toLowerCase();
  [...document.querySelectorAll(".card")].forEach(c=>{
    c.style.display=c.innerText.toLowerCase().includes(q)?"":"none";
  });
}

function save(){
  localStorage.setItem("data_"+currentMonth,JSON.stringify(data));
  localStorage.setItem("currentMonth",currentMonth);
}

function changeMonth(){
  save();
  currentMonth=monthPicker.value;
  data=JSON.parse(localStorage.getItem("data_"+currentMonth)||"[]");
  render();
}

function exportBackup(){
  save();
  const blob=new Blob([JSON.stringify({month:currentMonth,data},null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="backup_"+currentMonth+".json";
  a.click();
}

function importBackup(){importFile.click()}
importFile.onchange=e=>{
  const r=new FileReader();
  r.onload=()=>{
    const b=JSON.parse(r.result);
    currentMonth=b.month;
    data=b.data;
    save();
    monthPicker.value=currentMonth;
    render();
  };
  r.readAsText(e.target.files[0]);
};

function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("dark",document.body.classList.contains("dark"));
}
if(localStorage.getItem("dark")==="true")document.body.classList.add("dark");

/* COLORFUL PDF */
function exportPDF(){
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF();
  doc.setFontSize(16);
  doc.text("Student Lodge Report",14,14);
  doc.setFontSize(12);
  doc.text(currentMonth,14,22);

  let y=32;
  doc.setFillColor(79,70,229);
  doc.setTextColor(255,255,255);
  ["No","Name","Status"].forEach((h,i)=>{
    doc.rect(14+i*60,y,60,10,"F");
    doc.text(h,18+i*60,y+7);
  });

  y+=10;
  data.forEach((r,i)=>{
    doc.setFillColor(i%2?240:255);
    doc.rect(14,y,180,10,"F");
    doc.setTextColor(0,0,0);
    doc.text(String(i+1),18,y+7);
    doc.text(r.name||"",78,y+7);
    doc.setTextColor(r.paid?22:220,r.paid?163:38,74);
    doc.text(r.paid?"PAID":"NOT PAID",138,y+7);
    y+=10;
  });

  doc.save("Student_Lodge_"+currentMonth+".pdf");
}

render();
</script>

</body>
</html>
