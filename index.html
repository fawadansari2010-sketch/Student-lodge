<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Student Lodge â€“ Fawad Apps</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
*{
  box-sizing:border-box;
  -webkit-tap-highlight-color:transparent;
}
body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:#f4f4f5;
}
body.dark{background:#020617;color:#e5e7eb}

/* PREMIUM ANIMATIONS */
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
@keyframes scaleTap{from{transform:scale(.96)}to{transform:scale(1)}}

.card{animation:fadeUp .35s ease}
button:active{animation:scaleTap .15s ease}

/* Splash */
#splash{
  position:fixed;
  inset:0;
  background:linear-gradient(135deg,#4f46e5,#1e293b);
  color:#fff;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  align-items:center;
  padding:30px 20px;
  z-index:5000;
  text-align:center;
}
#splash h1{margin-top:20px;font-size:26px}
#splash h1 span{display:block;font-size:14px;opacity:.9}
#splash h2{margin-top:10px;font-weight:500}
#splash .go-btn{
  width:160px;
  padding:14px;
  font-size:16px;
  border-radius:30px;
  background:#fff;
  color:#4f46e5;
  font-weight:700;
  border:none;
}
#splash footer{font-size:13px;opacity:.85}

header{
  position:sticky;
  top:0;
  background:#fff;
  padding:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  z-index:100;
}
body.dark header{background:#020617}

.menu-btn,.add-btn{
  font-size:22px;
  padding:8px 14px;
  border-radius:14px;
}

#menu{
  position:fixed;
  background:#fff;
  border-radius:18px;
  padding:12px;
  width:240px;
  display:none;
  z-index:1000;
  box-shadow:0 10px 30px rgba(0,0,0,.2);
  animation:fadeUp .25s ease;
}
body.dark #menu{background:#1e293b}

button{
  width:100%;
  padding:10px;
  margin:6px 0;
  border:none;
  border-radius:14px;
  background:#4f46e5;
  color:#fff;
  font-size:14px;
}

#search{
  width:calc(100% - 20px);
  margin:10px;
  padding:12px;
  border-radius:18px;
  border:1px solid #ccc;
}

.card{
  background:#fff;
  margin:10px;
  border-radius:20px;
  padding:10px;
}
body.dark .card{background:#1e293b}

.row{display:flex;align-items:center;gap:8px}
.arrow{transition:.25s}
.arrow.open{transform:rotate(90deg)}
.tick.paid{color:#16a34a}
.tick.unpaid{color:#dc2626}

.expand{
  display:none;
  animation:fadeUp .25s ease;
}
.expand.show{display:block}

input{
  width:100%;
  padding:10px;
  margin:4px 0;
  border-radius:14px;
  border:1px solid #ccc;
  font-size:16px;
}
</style>
</head>

<body>

<div id="splash">
  <div>
    <h1>Fawad Apps <span>A Company of Trust</span></h1>
    <h2>Naoushad Raushan Lodge</h2>
  </div>
  <button class="go-btn" onclick="enterApp()">GO</button>
  <footer>This app is created by Fawad Ansari</footer>
</div>

<header>
  <div class="menu-btn" id="menuBtn">â‹®</div>
  <b>Fawad Apps</b>
  <div class="add-btn" onclick="addStudent()">ï¼‹</div>
</header>

<div id="menu">
  <input type="month" id="monthPicker">
  <button onclick="changeMonth()">ðŸ“… Change Month</button>
  <button onclick="save()">ðŸ’¾ Save</button>
  <button onclick="exportBackup()">ðŸ“¤ Export Backup</button>
  <button onclick="importBackup()">ðŸ“¥ Import Backup</button>
  <button onclick="toggleDark()">ðŸŒ™ Dark Mode</button>
  <button onclick="exportPDF()">ðŸ“„ Export PDF</button>
  <input type="file" id="importFile" hidden>
</div>

<input id="search" placeholder="Search name" oninput="search(this.value)">
<div id="list"></div>

<script>
/* --- ORIGINAL LOGIC PRESERVED --- */

if(sessionStorage.getItem("entered")==="true") splash.style.display="none";
function enterApp(){splash.style.display="none";sessionStorage.setItem("entered","true");}

const menu=document.getElementById("menu");
menuBtn.onclick=e=>{
  const r=e.target.getBoundingClientRect();
  menu.style.top=r.bottom+8+"px";
  menu.style.left=r.right-menu.offsetWidth+"px";
  menu.style.display=menu.style.display==="block"?"none":"block";
};

let currentMonth=localStorage.getItem("currentMonth")||new Date().toISOString().slice(0,7);
let data=JSON.parse(localStorage.getItem("data_"+currentMonth)||"[]");
monthPicker.value=currentMonth;

function addStudent(){data.push({name:"",room:"",floor:"",mobile:"",paid:false,open:false});render();}
function toggleRow(i){data[i].open=!data[i].open;render()}
function togglePaid(i){data[i].paid=!data[i].paid;render()}
function removeRow(i){data.splice(i,1);render()}

function render(){
  list.innerHTML="";
  data.forEach((r,i)=>{
    list.innerHTML+=`
    <div class="card">
      <div class="row">
        <div>${i+1}</div>
        <div class="tick ${r.paid?"paid":"unpaid"}">${r.paid?"âœ”":"âœ–"}</div>
        <input value="${r.name}" placeholder="Name" oninput="data[${i}].name=this.value">
        <div class="arrow ${r.open?"open":""}" onclick="toggleRow(${i})">â–¶</div>
      </div>
      <div class="expand ${r.open?"show":""}">
        <input placeholder="Room" value="${r.room||""}" oninput="data[${i}].room=this.value">
        <input placeholder="Floor" value="${r.floor||""}" oninput="data[${i}].floor=this.value">
        <input type="tel" placeholder="Mobile" value="${r.mobile||""}" oninput="data[${i}].mobile=this.value">
        <button onclick="togglePaid(${i})">${r.paid?"Paid":"Not Paid"}</button>
        <button onclick="openWhatsApp(${i})" style="background:#22c55e">ðŸ’¬ WhatsApp Reminder</button>
        <button style="background:#991b1b" onclick="removeRow(${i})">Delete</button>
      </div>
    </div>`;
  });
}

/* --- WHATSAPP --- */
function openWhatsApp(i){
  if(!data[i].mobile)return alert("Mobile number missing");
  const msg=encodeURIComponent(
    "Please pay your dues for the current month at the lodge. Kindly ignore this message if payment has already been made."
  );
  window.open(`https://wa.me/91${data[i].mobile}?text=${msg}`);
}

function search(q){
  q=q.toLowerCase();
  document.querySelectorAll(".card").forEach((c,i)=>{
    c.style.display=(data[i]?.name||"").toLowerCase().includes(q)?"":"none";
  });
}

function save(){
  localStorage.setItem("data_"+currentMonth,JSON.stringify(data));
  localStorage.setItem("currentMonth",currentMonth);
}

function changeMonth(){
  save();
  currentMonth=monthPicker.value;
  data=JSON.parse(localStorage.getItem("data_"+currentMonth)||"[]");
  render();
}

function exportBackup(){
  save();
  const b=new Blob([JSON.stringify({month:currentMonth,data},null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="backup_"+currentMonth+".json";
  a.click();
}

function importBackup(){importFile.click()}
importFile.onchange=e=>{
  const r=new FileReader();
  r.onload=()=>{
    const b=JSON.parse(r.result);
    currentMonth=b.month;
    data=b.data;
    save();
    monthPicker.value=currentMonth;
    render();
  };
  r.readAsText(e.target.files[0]);
};

function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("dark",document.body.classList.contains("dark"));
}
if(localStorage.getItem("dark")==="true")document.body.classList.add("dark");

/* âœ… ORIGINAL PDF FUNCTION â€“ RESTORED */
function exportPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p","mm","a4");

  const pageW = doc.internal.pageSize.getWidth();

  const monthName=new Date(currentMonth+"-01")
    .toLocaleString("en-US",{month:"long",year:"numeric"});

  doc.setFontSize(14);
  doc.text("Student Lodge Payment Report",pageW/2,20,{align:"center"});
  doc.setFontSize(11);
  doc.text(monthName,pageW/2,27,{align:"center"});

  const startX=15;
  let y=40;
  const rowH=10;
  const colW=[20,110,40];

  ["S.No","Name","Status"].forEach((t,i)=>{
    doc.rect(startX+colW.slice(0,i).reduce((a,b)=>a+b,0),y,colW[i],rowH);
    doc.text(t,startX+colW.slice(0,i).reduce((a,b)=>a+b,0)+3,y+7);
  });

  y+=rowH;

  data.forEach((r,i)=>{
    if(y>280){
      doc.addPage();
      y=20;
      doc.setFontSize(11);
    }

    r.paid?doc.setFillColor(220,252,231):doc.setFillColor(254,226,226);

    doc.rect(startX,y,colW[0],rowH,"F");
    doc.rect(startX+colW[0],y,colW[1],rowH,"F");
    doc.rect(startX+colW[0]+colW[1],y,colW[2],rowH,"F");

    doc.setDrawColor(0);
    doc.rect(startX,y,colW[0],rowH);
    doc.rect(startX+colW[0],y,colW[1],rowH);
    doc.rect(startX+colW[0]+colW[1],y,colW[2],rowH);

    doc.text(String(i+1),startX+5,y+7);
    doc.text(r.name||"",startX+colW[0]+3,y+7);

    doc.setTextColor(r.paid?22:185,r.paid?163:28,r.paid?74:28);
    doc.text(r.paid?"PAID":"NOT PAID",startX+colW[0]+colW[1]+5,y+7);
    doc.setTextColor(0);

    y+=rowH;
  });

  doc.save("Student_Lodge_"+currentMonth+".pdf");
}

render();
</script>
</body>
</html>
